<% content_for :title, "#{@participant.name} - Admin" %>

<div class="max-w-4xl mx-auto">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900"><%= @participant.name %></h1>
      <% if @participant.title.present? %>
        <p class="text-gray-600"><%= @participant.title %></p>
      <% end %>
    </div>
    <div class="flex gap-2">
      <%= link_to "Edit", edit_admin_participant_path(@participant), class: "bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" %>
      <%= link_to "Merge into...", merge_admin_participant_path(@participant), class: "bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700" %>
    </div>
  </div>

  <% if flash[:notice] %>
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
      <p class="text-green-800"><%= flash[:notice] %></p>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <%# Main info %>
    <div class="md:col-span-2 space-y-6">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-medium text-gray-900 mb-4">Details</h2>
        
        <div class="space-y-4">
          <% if @participant.company.present? || @participant.company_name.present? %>
            <div>
              <label class="text-sm font-medium text-gray-500">Company</label>
              <p class="text-gray-900">
                <% if @participant.company.present? %>
                  <%= link_to @participant.company.name, admin_company_path(@participant.company), class: "text-blue-600 hover:underline" %>
                <% else %>
                  <%= @participant.company_name %>
                <% end %>
              </p>
            </div>
          <% end %>

          <% if @participant.bio.present? %>
            <div>
              <label class="text-sm font-medium text-gray-500">Bio</label>
              <div class="text-gray-900 mt-1"><%= simple_format(@participant.bio) %></div>
            </div>
          <% end %>

          <% if @participant.linkedin_url.present? %>
            <div>
              <label class="text-sm font-medium text-gray-500">LinkedIn</label>
              <p><%= link_to @participant.linkedin_url, @participant.linkedin_url, target: "_blank", class: "text-blue-600 hover:underline" %></p>
            </div>
          <% end %>

          <% if @participant[:alias].present? %>
            <% aliases = JSON.parse(@participant[:alias]) rescue [] %>
            <% if aliases.any? %>
              <div>
                <label class="text-sm font-medium text-gray-500">Also Known As</label>
                <p class="text-gray-900"><%= aliases.join(", ") %></p>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>

      <%# Related records counts %>
      <% counts = @participant.related_counts %>
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-medium text-gray-900 mb-4">Related Records</h2>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
          <div class="text-center p-3 bg-gray-50 rounded">
            <div class="text-2xl font-bold text-blue-600"><%= counts[:news_items] %></div>
            <div class="text-xs text-gray-600">News Items</div>
          </div>
          <div class="text-center p-3 bg-gray-50 rounded">
            <div class="text-2xl font-bold text-purple-600"><%= counts[:knowledge_sessions] %></div>
            <div class="text-xs text-gray-600">Sessions</div>
          </div>
          <div class="text-center p-3 bg-gray-50 rounded">
            <div class="text-2xl font-bold text-yellow-600"><%= counts[:mvp_awards] %></div>
            <div class="text-xs text-gray-600">MVP Awards</div>
          </div>
          <div class="text-center p-3 bg-gray-50 rounded">
            <div class="text-2xl font-bold text-green-600"><%= counts[:snapp_cards] %></div>
            <div class="text-xs text-gray-600">Snapp Cards</div>
          </div>
          <div class="text-center p-3 bg-gray-50 rounded">
            <div class="text-2xl font-bold text-red-600"><%= counts[:startup_founders] %></div>
            <div class="text-xs text-gray-600">Founder Records</div>
          </div>
        </div>
      </div>

      <%# MVP Awards %>
      <% if @participant.mvp_awards.any? %>
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">MVP Awards</h2>
          <div class="space-y-2">
            <% @participant.mvp_awards.recent_first.each do |award| %>
              <div class="flex items-center gap-3 p-3 bg-gray-50 rounded">
                <span class="text-sm font-medium text-gray-900"><%= award.year %></span>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= award.badge_color %>">
                  <%= award.award_type %>
                </span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <%# Sidebar %>
    <div class="space-y-6">
      <% if @participant.image_url.present? %>
        <div class="bg-white rounded-lg shadow p-4">
          <img src="<%= @participant.image_url %>" class="w-full rounded-lg">
        </div>
      <% end %>

      <div class="bg-gray-50 rounded-lg p-4">
        <h3 class="text-sm font-medium text-gray-700 mb-2">Public Profile</h3>
        <%= link_to "View on site →", who_path(name: @participant.slug), target: "_blank", class: "text-blue-600 hover:underline text-sm" %>
      </div>

      <div class="bg-gray-50 rounded-lg p-4">
        <h3 class="text-sm font-medium text-gray-700 mb-2">Actions</h3>
        <div class="space-y-2">
          <%= link_to "← Back to list", admin_participants_path, class: "text-gray-600 hover:text-gray-900 text-sm block" %>
          <%= link_to "View duplicates", duplicates_admin_participants_path, class: "text-orange-600 hover:text-orange-800 text-sm block" %>
        </div>
      </div>
    </div>
  </div>
</div>
