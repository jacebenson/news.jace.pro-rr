<% content_for :title, "News Items - News Jace Pro" %>

<div class="mt-4">
  <%# Header with search %>
  <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">ServiceNow News</h1>
      <p class="text-gray-600"><%= @news_items.total_count %> items</p>
    </div>

    <form class="flex gap-2" onsubmit="return handleNewsSearch(event)">
      <input type="text" id="news-search-input" value="<%= @search %>" placeholder="Search news..."
          class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border text-sm w-64">
      <button type="submit" class="rounded-md bg-blue-600 px-4 py-2 text-white text-sm hover:bg-blue-700 cursor-pointer">Search</button>
      <% if @search.present? || @participant.present? %>
        <%= link_to "Clear", items_path, class: "rounded-md border border-gray-300 bg-white px-4 py-2 text-gray-700 text-sm hover:bg-gray-50" %>
      <% end %>
    </form>
    <script>
      function handleNewsSearch(e) {
        e.preventDefault();
        const search = document.getElementById('news-search-input').value.trim();
        if (search) {
          window.location.href = '/i/search/' + encodeURIComponent(search);
        } else {
          window.location.href = '/i';
        }
        return false;
      }
    </script>
  </div>

  <% if @participant %>
    <div class="mb-4 flex items-center gap-3 bg-blue-50 border border-blue-200 rounded-lg p-3">
      <% if @participant.image_url.present? %>
        <img src="<%= @participant.image_url %>" alt="<%= @participant.name %>" class="h-12 w-12 rounded-full object-cover">
      <% end %>
      <div class="flex-1">
        <h2 class="font-bold text-gray-900"><%= @participant.name %></h2>
        <p class="text-sm text-gray-600"><%= @participant.title %></p>
      </div>
      <%= link_to "View Profile", who_path(name: @participant.slug), class: "text-blue-600 hover:underline text-sm" %>
      <%= link_to "Clear Filter", items_path, class: "text-gray-500 hover:text-gray-700 text-sm ml-2" %>
    </div>
  <% end %>

  <% if @search.present? %>
    <div class="mb-4 bg-gray-50 border border-gray-200 rounded-lg p-3">
      <p class="text-sm text-gray-600">
        Search results for: "<span class="font-medium"><%= @search %></span>"
      </p>
    </div>
  <% end %>

  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
    <% @news_items.each do |item| %>
      <%= render "news_items/card", item: item %>
    <% end %>
  </div>

  <% if @news_items.empty? %>
    <div class="text-center py-12">
      <p class="text-gray-500">No news items found</p>
    </div>
  <% end %>

  <div class="mt-6">
    <%= paginate @news_items %>
  </div>
</div>
